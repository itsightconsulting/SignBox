CREATE OR REPLACE PROCEDURE FUNC_AMBIENTES_Q_DYNAMIC_WHERE (
    u_Limit          INT DEFAULT NULL ,
    u_Offset         INT DEFAULT 0,
    u_nombre         VARCHAR(200),
    u_flagActivo     BOOLEAN)

    RETURNS TABLE ( ambientesId INT,
                        nombre VARCHAR(200),
                        prefijo VARCHAR(200),
                        FLAGACTIVO BOOLEAN,
                        rows INT)
        LANGUAGE SQL

BEGIN ATOMIC


        SELECT PR.ambientesId,
                   PR.nombre,
                   PR.prefijo,
                   PR.FLAGACTIVO,
                   PR.ROWS
            FROM (
					SELECT row_number() OVER ( ORDER BY p.ambientesId ) AS RID,
							P.ambientesId,
							P.nombre,
							P.prefijo,
							P.FLAGACTIVO,
							CAST(COUNT(*) OVER() AS INT) AS ROWS
					FROM  VQJ33260.ambientes AS P
					WHERE P.nombre LIKE concat(concat('%', trim(u_nombre)) , '%' ) AND
						P.FLAGACTIVO = u_flagActivo AND
						(P.FlagEliminado = 0)
					ORDER BY P.ambientesId desc
                 ) PR
            WHERE PR.RID BETWEEN u_Offset AND u_Offset + u_Limit;


END;