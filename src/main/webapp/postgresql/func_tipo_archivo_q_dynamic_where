CREATE OR REPLACE PROCEDURE FUNC_TIPO_ARCHIVO_Q_DYNAMIC_WHERE (
    u_Limit          INT DEFAULT NULL ,
    u_Offset         INT DEFAULT 0,
    u_nombre         VARCHAR(200),
    u_flagActivo     BOOLEAN,
    u_IDFORMATOFIRMA INT DEFAULT 0)

    RETURNS TABLE ( TIPOARCHIVOID INT,
                        CODIGOARCHIVO VARCHAR(200),
                        EXTENSIONES VARCHAR(200),
                        DESCRIPCION VARCHAR(200),
                        IDFORMATOFIRMA int,
                        DETALLE VARCHAR(200),
                        FLAGACTIVO BOOLEAN,
                        rows INT)
        LANGUAGE SQL

BEGIN ATOMIC


        SELECT PR.TIPOARCHIVOID,
                   PR.CODIGOARCHIVO,
                   PR.EXTENSIONES,
                   PR.DESCRIPCION,
                   PR.IDFORMATOFIRMA,
                   PR.DETALLE,
                   PR.FLAGACTIVO,
                   PR.ROWS
            FROM (
                     SELECT row_number() OVER ( ORDER BY p.TIPOARCHIVOID ) AS RID,
                            P.TIPOARCHIVOID,
                            P.CODIGOARCHIVO,
                            P.EXTENSIONES,
                            P.DESCRIPCION,
                            P.IDFORMATOFIRMA,
                            a.DETALLE,
                            P.FLAGACTIVO,
                            CAST(COUNT(*) OVER() AS INT) AS ROWS
                     FROM  TIPOARCHIVO AS P
                      inner join tipofirma as a on p.IDFORMATOFIRMA = a.tipofirmaid
                      WHERE P.DESCRIPCION LIKE concat(concat('%', trim(u_nombre)) , '%' ) AND
                            P.FLAGACTIVO = u_flagActivo AND
                            (P.IDFORMATOFIRMA = u_IDFORMATOFIRMA OR u_IDFORMATOFIRMA = 0)
                     ORDER BY P.TIPOARCHIVOID desc
                 ) PR
            WHERE PR.RID BETWEEN u_Offset AND u_Offset + u_Limit;


END;